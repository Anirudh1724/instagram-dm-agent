# Redis Configuration for Production Persistence
# This configuration ensures all data is saved to disk and survives restarts

# =============================================================================
# PERSISTENCE - RDB (Point-in-time snapshots)
# =============================================================================

# Save the DB to disk:
# save <seconds> <changes>
# Will save the DB if both conditions are met.

# Save after 900 sec (15 min) if at least 1 key changed
save 900 1

# Save after 300 sec (5 min) if at least 10 keys changed
save 300 10

# Save after 60 sec if at least 100 keys changed
save 60 100

# The filename where to dump the DB
dbfilename dump.rdb

# The directory where the DB file will be saved
# Using a dedicated data directory
dir ./data/redis

# Compress string objects using LZF compression
rdbcompression yes

# Checksum at the end of the RDB file
rdbchecksum yes

# =============================================================================
# PERSISTENCE - AOF (Append Only File) - More durable
# =============================================================================

# Enable AOF persistence
appendonly yes

# The name of the append only file
appendfilename "appendonly.aof"

# How often to sync data to disk:
# - always: slowest, safest (every write)
# - everysec: good balance (once per second) - RECOMMENDED
# - no: fastest, OS decides when to sync (can lose data)
appendfsync everysec

# Don't rewrite AOF while RDB save in progress (prevents disk I/O spikes)
no-appendfsync-on-rewrite no

# Trigger AOF rewrite when file is 100% bigger than last rewrite
auto-aof-rewrite-percentage 100

# Minimum size for AOF rewrite trigger
auto-aof-rewrite-min-size 64mb

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================

# Max memory (adjust based on your server)
# Uncomment and set for production:
# maxmemory 256mb

# What to do when maxmemory is reached
# Options: volatile-lru, allkeys-lru, volatile-random, allkeys-random, volatile-ttl, noeviction
# noeviction = don't delete anything, return error on write
maxmemory-policy noeviction

# =============================================================================
# GENERAL
# =============================================================================

# Accept connections on port 6379
port 6379

# Bind to localhost only (for security)
bind 127.0.0.1

# Disable protected mode for local development
# Enable this in production with proper authentication
protected-mode no

# Log level (debug, verbose, notice, warning)
loglevel notice

# Log file location (empty = stdout, better for debugging)
logfile ""


# Number of databases
databases 16

# =============================================================================
# SECURITY (Enable for production)
# =============================================================================

# Uncomment and set a strong password for production:
# requirepass your_strong_password_here

# =============================================================================
# CLIENT CONNECTIONS
# =============================================================================

# Max number of connected clients
maxclients 100

# Close connection after client is idle for N seconds (0 = disabled)
timeout 0

# TCP keepalive
tcp-keepalive 300
